/**
 * Unload a node module and all associated children from node require cache
 * @param {string} moduleName The name of the module or absolute/relative path to it
 */
function unloadModule(moduleName) {
    moduleName = '../' + moduleName;
    var solvedName = require.resolve(moduleName),
        nodeModule = require.cache[solvedName];
    if (nodeModule) {
        for (var i = 0; i < nodeModule.children.length; i++) {
            var child = nodeModule.children[i];
            unloadModule(child.filename);
        }
        delete require.cache[solvedName];
    }
}

module.exports = unloadModule;
